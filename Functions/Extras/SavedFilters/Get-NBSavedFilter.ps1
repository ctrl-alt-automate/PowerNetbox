<#
.SYNOPSIS
    Retrieves saved filters from Netbox.

.DESCRIPTION
    Retrieves saved filters from Netbox Extras module.

.PARAMETER Id
    Database ID of the saved filter.

.PARAMETER Name
    Filter by name.

.PARAMETER Slug
    Filter by slug.

.PARAMETER Object_Types
    Filter by object types.

.PARAMETER User_Id
    Filter by user ID.

.PARAMETER Enabled
    Filter by enabled status.

.PARAMETER Shared
    Filter by shared status.

.PARAMETER Query
    Search query.

.PARAMETER Limit
    Number of results to return.

.PARAMETER Offset
    Result offset for pagination.

.PARAMETER Raw
    Return the raw API response.

.EXAMPLE
    Get-NBSavedFilter

.LINK
    https://netbox.readthedocs.io/en/stable/rest-api/overview/
#>
function Get-NBSavedFilter {
    [CmdletBinding(DefaultParameterSetName = 'Query')]
    [OutputType([PSCustomObject])]
    param (
        [switch]$All,

        [ValidateRange(1, 1000)]
        [int]$PageSize = 100,

        [Parameter(ParameterSetName = 'ById', ValueFromPipelineByPropertyName = $true)]
        [uint64[]]$Id,

        [Parameter(ParameterSetName = 'Query')]
        [string]$Name,

        [Parameter(ParameterSetName = 'Query')]
        [string]$Slug,

        [Parameter(ParameterSetName = 'Query')]
        [string]$Object_Types,

        [Parameter(ParameterSetName = 'Query')]
        [uint64]$User_Id,

        [Parameter(ParameterSetName = 'Query')]
        [bool]$Enabled,

        [Parameter(ParameterSetName = 'Query')]
        [bool]$Shared,

        [Parameter(ParameterSetName = 'Query')]
        [string]$Query,

        [ValidateRange(1, 1000)]
        [uint16]$Limit,

        [ValidateRange(0, [int]::MaxValue)]
        [uint16]$Offset,

        [switch]$Raw
    )

    process {
        Write-Verbose "Retrieving Saved Filter"
        switch ($PSCmdlet.ParameterSetName) {
            'ById' {
                foreach ($i in $Id) {
                    $Segments = [System.Collections.ArrayList]::new(@('extras', 'saved-filters', $i))
                    $URIComponents = BuildURIComponents -URISegments $Segments.Clone() -ParametersDictionary $PSBoundParameters -SkipParameterByName 'Id', 'Raw'
                    $URI = BuildNewURI -Segments $URIComponents.Segments -Parameters $URIComponents.Parameters
                    InvokeNetboxRequest -URI $URI -Raw:$Raw -All:$All -PageSize $PageSize
                }
            }
            default {
                $Segments = [System.Collections.ArrayList]::new(@('extras', 'saved-filters'))
                $URIComponents = BuildURIComponents -URISegments $Segments.Clone() -ParametersDictionary $PSBoundParameters -SkipParameterByName 'Raw', 'All', 'PageSize'
                $URI = BuildNewURI -Segments $URIComponents.Segments -Parameters $URIComponents.Parameters
                InvokeNetboxRequest -URI $URI -Raw:$Raw -All:$All -PageSize $PageSize
            }
        }
    }
}
